<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Design system checklist</title>
    <style>
        :root {
            color-scheme: light dark;
        }
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            margin: 24px;
            line-height: 1.4;
            max-width: 920px;
        }
        header {
            display: grid;
            gap: 8px;
            margin-bottom: 18px;
        }
        .bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            padding: 10px;
            border: 1px solid rgba(127,127,127,.35);
            border-radius: 10px;
        }
        button {
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid rgba(127,127,127,.35);
            background: transparent;
            cursor: pointer;
        }
        button:hover {
            border-color: rgba(127,127,127,.65);
        }
        .muted {
            opacity: .75;
            font-size: 14px;
        }
        .progress {
            font-variant-numeric: tabular-nums;
        }
        .chapters {
            display: grid;
            gap: 14px;
        }
        .chapter {
            border: 1px solid rgba(127,127,127,.35);
            border-radius: 14px;
            padding: 14px;
            display: grid;
            gap: 10px;
        }
        .chapter-header {
            display: flex;
            flex-wrap: wrap;
            align-items: baseline;
            gap: 10px;
        }
        .chapter-title {
            margin: 0;
            font-size: 18px;
        }
        .chapter-progress {
            margin-left: auto;
            opacity: .8;
            font-size: 14px;
            font-variant-numeric: tabular-nums;
        }
        ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            gap: 10px;
        }
        li {
            border: 1px solid rgba(127,127,127,.25);
            border-radius: 12px;
            padding: 12px 12px;
            display: grid;
            gap: 6px;
        }
        label {
            display: flex;
            gap: 10px;
            align-items: start;
            cursor: pointer;
        }
        input[type="checkbox"] {
            transform: translateY(2px);
        }
        .desc {
            margin-left: 26px;
            opacity: .8;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <header>
        <h1 style="margin:0;">Checklist per un design system completo</h1>

        <div class="bar">
        <strong class="progress" id="progress">0/0</strong>
        <span class="muted" id="lastSaved"></span>
        <span style="flex:1;"></span>
        <button type="button" id="checkAll">Seleziona tutto</button>
        <button type="button" id="uncheckAll">Deseleziona tutto</button>
        <button type="button" id="reset">Reset</button>
        </div>

        <p class="muted" style="margin:0;">
        Salva automaticamente nel browser (localStorage). Se cambi dispositivo o browser, non trovi le spunte.
        </p>
    </header>

    <main>
        <div class="chapters" id="chapters"></div>
    </main>

    <script>
        /**
        * ✅ QUI DEFINISCI I CAPITOLI
        * Ogni capitolo ha:
        * - id: stringa unica
        * - title: titolo del capitolo
        * - items: array di checkbox
        */
        const chapters = [
        {
            id: "setup",
            title: "Setup",
            items: [
            { id: "setup_1", title: "Installare gli strumenti", desc: "Editor, estensioni, repo clonato, ecc." },
            { id: "setup_2", title: "Creare struttura cartelle", desc: "Tokens, components, docs, utilities…" },
            ],
        },
        {
            id: "tokens",
            title: "Design Tokens",
            items: [
            { id: "tokens_1", title: "Definire palette colori", desc: "Brand + neutrali + semantic colors." },
            { id: "tokens_2", title: "Tipografia", desc: "Scale, pesi, line-height, spacing verticale." },
            { id: "tokens_3", title: "Spacing system", desc: "8pt / 4pt system + naming coerente." },
            ],
        },
        {
            id: "components",
            title: "Componenti",
            items: [
            { id: "components_1", title: "Button", desc: "States, sizes, variants." },
            { id: "components_2", title: "Input", desc: "Error state, focus, disabled." },
            { id: "components_3", title: "Card", desc: "Padding, shadow, layout responsivo." },
            ],
        },
        ];

        // Namespace per evitare collisioni tra più checklist
        const STORAGE_KEY = "checklist:v2:chapters";

        const $chapters = document.getElementById("chapters");
        const $progress = document.getElementById("progress");
        const $lastSaved = document.getElementById("lastSaved");

        const $checkAll = document.getElementById("checkAll");
        const $uncheckAll = document.getElementById("uncheckAll");
        const $reset = document.getElementById("reset");

        function allItemsFlat() {
        const all = [];
        for (const ch of chapters) {
            for (const it of ch.items) {
            all.push(it);
            }
        }
        return all;
        }

        function loadState() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return { checked: {}, lastSaved: null };
            const parsed = JSON.parse(raw);
            return {
            checked: parsed.checked || {},
            lastSaved: parsed.lastSaved || null,
            };
        } catch {
            return { checked: {}, lastSaved: null };
        }
        }

        function saveState(state) {
        const payload = {
            checked: state.checked,
            lastSaved: Date.now(),
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        return payload.lastSaved;
        }

        function formatLastSaved(ts) {
        if (!ts) return "";
        return `Ultimo salvataggio: ${new Date(ts).toLocaleString("it-IT", { dateStyle:"medium", timeStyle:"short" })}`;
        }

        function computeChapterProgress(chapter, state) {
        const total = chapter.items.length;
        const done = chapter.items.reduce((acc, it) => acc + (state.checked[it.id] ? 1 : 0), 0);
        return { done, total };
        }

        function computeGlobalProgress(state) {
        const items = allItemsFlat();
        const total = items.length;
        const done = items.reduce((acc, it) => acc + (state.checked[it.id] ? 1 : 0), 0);
        return { done, total };
        }

        function render(state) {
        $chapters.innerHTML = "";

        for (const chapter of chapters) {
            const $chapter = document.createElement("section");
            $chapter.className = "chapter";
            $chapter.dataset.chapterId = chapter.id;

            const $header = document.createElement("div");
            $header.className = "chapter-header";

            const $title = document.createElement("h2");
            $title.className = "chapter-title";
            $title.textContent = chapter.title;

            const $chProg = document.createElement("div");
            $chProg.className = "chapter-progress";
            $chProg.dataset.chapterProgress = chapter.id;

            $header.appendChild($title);
            $header.appendChild($chProg);

            const $list = document.createElement("ul");
            $list.dataset.chapterList = chapter.id;

            for (const item of chapter.items) {
            const li = document.createElement("li");

            const label = document.createElement("label");

            const cb = document.createElement("input");
            cb.type = "checkbox";
            cb.dataset.id = item.id;
            cb.checked = Boolean(state.checked[item.id]);

            const title = document.createElement("span");
            title.textContent = item.title;

            label.appendChild(cb);
            label.appendChild(title);
            li.appendChild(label);

            if (item.desc) {
                const p = document.createElement("div");
                p.className = "desc";
                p.textContent = item.desc;
                li.appendChild(p);
            }

            $list.appendChild(li);
            }

            $chapter.appendChild($header);
            $chapter.appendChild($list);

            $chapters.appendChild($chapter);
        }

        updateUI(state);
        }

        function updateUI(state) {
        // Global progress
        const global = computeGlobalProgress(state);
        $progress.textContent = `${global.done}/${global.total}`;

        // Chapter progress
        for (const chapter of chapters) {
            const { done, total } = computeChapterProgress(chapter, state);
            const el = document.querySelector(`[data-chapter-progress="${chapter.id}"]`);
            if (el) el.textContent = `${done}/${total}`;
        }

        // Last saved
        $lastSaved.textContent = formatLastSaved(state.lastSaved);
        }

        // Init
        let state = loadState();
        render(state);

        // Change listener (event delegation)
        $chapters.addEventListener("change", (e) => {
        const el = e.target;
        if (!(el instanceof HTMLInputElement)) return;
        if (el.type !== "checkbox") return;

        const id = el.dataset.id;
        state.checked[id] = el.checked;

        state.lastSaved = saveState(state);
        updateUI(state);
        });

        // Bulk actions
        $checkAll.addEventListener("click", () => {
        for (const it of allItemsFlat()) state.checked[it.id] = true;
        state.lastSaved = saveState(state);
        render(state);
        });

        $uncheckAll.addEventListener("click", () => {
        for (const it of allItemsFlat()) state.checked[it.id] = false;
        state.lastSaved = saveState(state);
        render(state);
        });

        $reset.addEventListener("click", () => {
        localStorage.removeItem(STORAGE_KEY);
        state = { checked: {}, lastSaved: null };
        render(state);
        });
    </script>
</body>
</html>
